<script type="application/javascript">
    var rootimgurl = "https://rokka-demos.rokka.io/template/"
    var rootimgurl = "http://test.rokka.test/watermark/"
    var timeout = null

    var defaults = {
        "font": "86d7ee",
        "color": "000000",
        "o": "20",
        "t": "My Watermark"

    }
    function updateImage() {

        var hash = document.getElementById('imagehash').value +".png"

        var props = {}
        var elements = document.getElementById('form').elements
        var urlStringOptions = []
        var vQueryOptions = {}
        for (i = 0; i < elements.length; i++) {
            var name = elements[i].getAttribute('name')
            if (name === "imagehash") {
                //     hash = document.getElementById('image').value +".png"
                continue;
            }
            var value = elements[i].value

            if (name === "color" ) {
                if ( value.length !== 6) {
                    value = ""
                }
            }
            if (defaults[name] && defaults[name] === value){
                value = ""
            }
            if (value) {
                if (value.includes("/")
                  || value.includes("-")
                  ||  value.includes("\\")
                  ||  value.includes("%")
                  ||  value.includes("#")
                  ||  value.includes("&")
                  ||  value.includes("?")
                  ||  value.includes(";")
                ) {

                    vQueryOptions[name] = value
                } else {
                    urlStringOptions.push(name + "-" + value)
                }
            }
        }
        imgurl = rootimgurl
        if (urlStringOptions.length > 0) {
            imgurl += 'v-' + urlStringOptions.join("-") + '/'
        }
        imgurl += hash
        var stringified = JSON.stringify(vQueryOptions)
        if (stringified !== '{}') {
            imgurl += '?v=' + encodeURIComponent(stringified)
              .replace(/%22/g, '"')
              .replace(/%20/g, ' ')
              .replace(/%2C/g, ",")
              .replace(/%7B/g, "{")
              .replace(/%7D/g, "}")
              .replace(/%3A/g, ":");
        }

        document.getElementById("url").value = imgurl

        if (timeout !== null) {
            window.clearTimeout(timeout)
        }
        timeout = window.setTimeout(function () {
            document.getElementById('image').src = imgurl
        }, 150)


    }
    function urlchange() {
        console.log(document.getElementById("url").value)
        document.getElementById('image').src  = document.getElementById("url").value
    }
</script>
<style>
    #demoForm input, #demoForm  select {
      width: inherit ! important;
      height: 30px !important;
    }

    #demoForm select {
      padding-left: 10px ! important;

    }

</style>